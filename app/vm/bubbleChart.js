!function(t){function n(t){function n(t,n){var r=n.length;i.push(function(){return"seq"==t?n[0].apply(this,e(arguments)):t+"("+(1==r&&"function"==typeof n[0]?n[0].apply(this,e(arguments)):n)+")"})}function e(t){return Array.prototype.slice.call(t)}var i=[];void 0!==t&&i.push(t);var r=function(){var t=this,n=e(arguments);return i.map(function(e){return e.apply(t,n)}).join(" ")};return["translate","rotate","scale","matrix","skewX","skewY","seq"].forEach(function(t){r[t]=function(){return n(t,e(arguments)),r}}),r}"undefined"!=typeof d3&&d3.svg&&(d3.svg.transform=n),"undefined"!=typeof module&&module.exports?module.exports=n:t.d3Transform=n}(this),$.extend(Array.prototype,{min:function(){return this.reduce(function(t,n){return n>t?t:n},0)},max:function(){return this.reduce(function(t,n){return t>n?t:n},0)},minBy:function(t){var n=[];return $.each(this,function(e,i){n.push(i[t])}),n.min()},maxBy:function(t){var n=[];return $.each(this,function(e,i){n.push(i[t])}),n.max()},toArray:function(t){var n=[];return $.each(this,function(e,i){n.push(i[t])}),n},shuffle:function(){for(var t,n,e=this.length;e;)n=Math.floor(Math.random()*e--),t=this[e],this[e]=this[n],this[n]=t;return this},distinct:function(){var t=[];return $.each(this,function(n,e){-1==$.inArray(e,t)&&t.push(e)}),t},findFirst:function(t,n){var e=void 0;return $.each(this,function(i,r){var o=void 0===n?r:r[n];return o===t?(e=i,!1):void 0}),this[e]}}),function(){$.misc={uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0,e="x"==t?n:3&n|8;return e.toString(16)})}}}(),function(){var t=function(){};t.prototype={on:function(t,n,e){var i=this;i.notifications=this.notifications||{},i.notifications[t]=i.notifications[t]||[],i.notifications[t].push({handler:n,able:e})},off:function(t,n){var e=this,i=arguments.length;if(0===i)return delete e.notifications;if(1===i)return delete e.notifications[t];e.notifications=e.notifications||{};var r=e.notifications[t]||[];$.each(r,function(i,r){return r.handler===n?(e.notifications[t].splice(i,1),!1):void 0})},send:function(){var t=arguments[0],n=this;n.notifications=n.notifications||{},n.notifications[t]=n.notifications[t]||[];var e=n.notifications[t],i=Array.prototype.slice.call(arguments,1);$.each(e,function(t,n){var e=void 0===n.able||n.able.apply(null,i);e&&n.handler.apply(null,i)})}};var n={};$.microObserver={create:function(e){return n[e]=new t,n[e]},get:function(t){var e=this;return n[t]||e.create(t)}}}(),function(t,n){"function"==typeof define&&define.amd?define(n):"object"==typeof exports?module.exports=n():t.MicroPlugin=n()}(this,function(){var t={};t.mixin=function(t){t.plugins={},t.prototype.initializePlugins=function(t){var e,i,r,o=this,a=[];if(o.plugins={names:[],settings:{},requested:{},loaded:{}},n.isArray(t))for(e=0,i=t.length;i>e;e++)"string"==typeof t[e]?a.push(t[e]):(o.plugins.settings[t[e].name]=t[e].options,a.push(t[e].name));else if(t)for(r in t)t.hasOwnProperty(r)&&(o.plugins.settings[r]=t[r],a.push(r));for(;a.length;)o.require(a.shift())},t.prototype.loadPlugin=function(n){var e=this,i=e.plugins,r=t.plugins[n];if(!t.plugins.hasOwnProperty(n))throw new Error('Unable to find "'+n+'" plugin');i.requested[n]=!0,i.loaded[n]=r.fn.apply(e,[e.plugins.settings[n]||{}]),i.names.push(n)},t.prototype.require=function(t){var n=this,e=n.plugins;if(!n.plugins.loaded.hasOwnProperty(t)){if(e.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');n.loadPlugin(t)}return e.loaded[t]},t.define=function(n,e){t.plugins[n]={name:n,fn:e}}};var n={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,n){"function"==typeof define&&define.amd?define(["microplugin"],n):"object"==typeof exports?module.exports=n(require("microplugin")):t.BubbleChart=n(t.MicroPlugin)}(this,function(t){var n=2*Math.PI;return d3.svg.BubbleChart=function(t){var n=this,e=t.size,i=t.size/3,r=t.size/2,o=t.size/10;n.options={},$.extend(n.options,{plugins:[],container:".bubbleChart",viewBoxSize:e,innerRadius:i,outerRadius:r,radiusMin:o,intersectDelta:0,transitDuration:1e3},t),$.extend(n.options,{radiusMax:n.options.outerRadius,intersectInc:n.options.intersectDelta},t),n.initializePlugins(n.options.plugins),n.setup(),n.registerClickEvent(n.getNodes()),n.moveToCentral(d3.select(".node"))},$.extend(d3.svg.BubbleChart.prototype,{getTransition:function(){return this.transition},getClickedNode:function(){return this.clickedNode},getCentralNode:function(){return this.centralNode},getOptions:function(){return this.options},randomCirclesPositions:function(t){for(var e=this,i=[],r=0,o=e.options;i.length<e.items.length&&++r<e.intervalMax;){var a=(e.values[i.length],e.options.radiusMax),s=e.innerRadius+a+Math.random()*(e.outerRadius-e.innerRadius-2*a),u=Math.random()*n,c=e.centralPoint+s*Math.cos(u),l=e.centralPoint+s*Math.sin(u),f=!1;$.each(i,function(n,e){var i=e.cx-c,r=e.cy-l,o=e.r+a;return i*i+r*r<Math.pow(o-t,2)?(f=!0,!1):void 0}),f||i.push({cx:c,cy:l,r:a,item:e.items[i.length]})}if(i.length<e.items.length){if(t===o.radiusMin)throw{message:"Not enough space for all bubble. Please change the options.",options:o};return e.randomCirclesPositions(t+o.intersectInc)}return i.shuffle()},getValues:function(){var t=[],n=this;return $.each(n.items,function(e,i){t.push(n.options.data.eval(i))}),t},setup:function(){var t=this,n=t.options;t.innerRadius=n.innerRadius,t.outerRadius=n.outerRadius,t.centralPoint=n.size/2,t.intervalMax=4*n.size,t.items=n.data.items,t.values=t.getValues(),t.valueMax=t.values.max(),t.svg=d3.select(n.container).append("svg").attr({preserveAspectRatio:"xMidYMid",width:n.size,height:n.size,"class":"bubbleChart"}).attr("viewBox",function(t){return["0 0",n.viewBoxSize,n.viewBoxSize].join(" ")}),t.circlePositions=t.randomCirclesPositions(n.intersectDelta);var e=t.svg.selectAll(".node").data(t.circlePositions).enter().append("g").attr("class",function(t){return["node",n.data.classed(t.item)].join(" ")}),i=d3.scale.category20();e.append("circle").attr({r:function(t){return t.r},cx:function(t){return t.cx},cy:function(t){return t.cy}}).style("fill",function(t){return void 0!==n.data.color?n.data.color(t.item):i(t.item.text)}).attr("opacity","0.8"),e.sort(function(t,e){return n.data.eval(e.item)-n.data.eval(t.item)}),t.transition={},t.event=$.microObserver.get($.misc.uuid()),n.supportResponsive&&($(window).resize(function(){var e=$(n.container).width();t.svg.attr("width",e),t.svg.attr("height",e)}),$(window).resize())},getCirclePositions:function(){return this.circlePositions},moveToCentral:function(t){var n=this,e=d3.svg.transform().translate(function(e){var i=(t.select("circle").attr("cx"),n.centralPoint-e.cx),r=n.centralPoint-e.cy;return[i,r]});n.centralNode=t,n.transition.centralNode=t.classed({active:!0}).transition().duration(n.options.transitDuration),n.transition.centralNode.attr("transform",e).select("circle").attr("r",function(t){return n.options.innerRadius})},moveToReflection:function(t,n){var e=this,i=d3.svg.transform().translate(function(t){var n=2*(e.centralPoint-t.cx),i=2*(e.centralPoint-t.cy);return[n,i]});t.transition().duration(e.options.transitDuration).delay(function(t,n){return 10*n}).attr("transform",n?"":i).select("circle").attr("r",function(t){return t.r})},reset:function(t){t.classed({active:!1})},registerClickEvent:function(t){var n=this,e=!1;t.style("cursor","pointer").on("click",function(t){n.clickedNode=d3.select(this),n.event.send("click",n.clickedNode),n.reset(n.centralNode),n.moveToCentral(n.clickedNode),n.moveToReflection(n.svg.selectAll(".node:not(.active)"),e),e=!e})},getNodes:function(){return this.svg.selectAll(".node")},get:function(){return this.svg}}),t.mixin(d3.svg.BubbleChart),d3.svg.BubbleChart}),d3.svg.BubbleChart.define("central-click",function(t){var n=this;n.setup=function(t){var e=n.setup;return function(t){var i=e.apply(this,arguments);return n.event.on("click",function(t){1===t.selectAll("text.central-click")[0].length&&alert("Hello there!\nCentral bubble is clicked.")}),i}}(),n.reset=function(t){var e=n.reset;return function(t){var n=e.apply(this,arguments);return t.select("text.central-click").remove(),n}}(),n.moveToCentral=function(e){var i=n.moveToCentral;return function(e){var r=i.apply(this,arguments),o=n.getTransition().centralNode;return o.each("end",function(){e.append("text").classed({"central-click":!0}).attr(t.attr).style(t.style).attr("x",function(t){return t.cx}).attr("y",function(t){return t.cy}).text(t.text).style("opacity",0).transition().duration(n.getOptions().transitDuration/2).style("opacity","0.8")}),r}}()}),d3.svg.BubbleChart.define("lines",function(t){var n=this;n.setup=function(){var e=n.setup;return function(){var i=e.apply(this,arguments),r=n.getNodes();return $.each(t.format,function(t,n){r.append("text").classed(n.classed).style(n.style).attr(n.attr).text(function(t){return t.item[n.textField]})}),i}}(),n.reset=function(e){var i=n.reset;return function(e){var r=i.apply(this,arguments);return $.each(t.format,function(t,i){var r=d3.select(e.selectAll("text")[0][t]);r.classed(i.classed).text(function(t){return t.item[i.textField]}).transition().duration(n.getOptions().transitDuration).style(i.style).attr(i.attr)}),r}}(),n.moveToCentral=function(e){var i=n.moveToCentral;return function(e){var r=i.apply(this,arguments);return $.each(t.centralFormat,function(t,i){var r=d3.select(e.selectAll("text")[0][t]);r.transition().duration(n.getOptions().transitDuration).style(i.style).attr(i.attr),void 0!==i.classed&&r.classed(i.classed),void 0!==i.textField&&r.text(function(t){return t.item[i.textField]})}),r}}()});